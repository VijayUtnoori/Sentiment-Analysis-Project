<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Analysis Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #e9eff6; font-family: 'Inter', sans-serif; }
        .sidebar-card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="min-h-screen" x-data="{ userDropdown: false, logoutModal: false }">

    <nav class="bg-[#1e3a8a] text-white p-3 px-6 flex justify-between items-center shadow-md relative z-10">
    
    <!--  FIX 3: Correct Logo Path -->
    <div class="flex items-center space-x-2">
        <!-- If logo is inside static/images/logo.png -->
        <img src="{{ url_for('static', filename='images/logo.png') }}" 
             alt="Logo" 
             class="h-12 w-auto object-contain">
    </div>

    <!--  FIX 2: Dynamic Active Navbar -->
    <div class="flex items-center space-x-8">
        <a href="{{ url_for('history') }}"
   class="hover:text-blue-200 transition pb-1 border-b-2 
   {{ 'border-white' if request.path == url_for('history') else 'border-transparent' }}">
   History
</a>
  <a href="{{ url_for('instructions') }}"
   class="hover:text-blue-200 transition pb-1 border-b-2 
   {{ 'border-white' if request.path == url_for('instructions') else 'border-transparent' }}">
   Instructions
</a>



        <a href="{{ url_for('trends') }}"
   class="hover:text-blue-200 transition pb-1 border-b-2 
   {{ 'border-white' if request.path == url_for('trends') else 'border-transparent' }}">
   Trends
</a>

        <!--  FIX 1: Fully Dynamic User Avatar -->
        <div class="relative">
            <button @click="userDropdown = !userDropdown"
                class="flex items-center bg-[#3b82f6] hover:bg-blue-500 rounded-full p-1 pr-3 transition focus:outline-none">

                <!-- Dynamic First Letter -->
                <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center text-blue-900 font-bold mr-2 uppercase">
                    {{ session['username'][0] if session.get('username') else 'U' }}
                </div>

                <i class="fas fa-chevron-down text-[10px] transition-transform"
                   :class="userDropdown ? 'rotate-180' : ''"></i>
            </button>

            <div x-show="userDropdown"
                 @click.away="userDropdown = false"
                 x-cloak
                 class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-2 text-gray-800 border">

                <!-- Dynamic Username + Email -->
                <div class="px-4 py-2 border-b">
                    <p class="text-sm font-bold truncate">
                        {{ session.get('username', 'User') }}
                    </p>
                    <p class="text-xs text-gray-500 truncate">
                        {{ session.get('email', 'user@example.com') }}
                    </p>
                </div>

                <button @click="logoutModal = true; userDropdown = false"
                        class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 flex items-center">
                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                </button>
            </div>
        </div>
    </div>
</nav>

    <div class="container mx-auto mt-8 px-4 flex flex-col md:flex-row gap-6">
        <aside class="w-full md:w-1/4 space-y-6">
            <div class="sidebar-card p-4">
                <div class="flex items-center text-blue-900 font-bold mb-4 border-b pb-2"><i class="fas fa-history mr-2"></i> History</div>
                <div id="history-container" class="space-y-3 min-h-[50px] text-sm text-gray-500 italic">No recent activity.</div>
                <a href="#" class="block text-center text-blue-600 text-sm mt-4 font-semibold">View All History ></a>
            </div>
            <div class="sidebar-card p-4">
                <div class="flex items-center text-blue-900 font-bold mb-4 border-b pb-2"><i class="fas fa-list-ul mr-2"></i> Instructions</div>
                <ol class="text-sm text-gray-600 space-y-3">
                    <li>1. Enter a sentiment and get the result.</li>
                    <li>2. Upload a file (CSV or TXT).</li>
                    <li>3. Max file size: 5MB.</li>
                    <li>4. Download results after analysis.</li>
                </ol>
            </div>
            <div class="sidebar-card p-4">
    <div class="flex items-center text-blue-900 font-bold mb-4">
        <i class="fas fa-folder-open mr-2"></i> Upload File
    </div>

    <a href="/upload"
       class="block text-center w-full bg-[#2563eb] text-white py-2 rounded-md hover:bg-blue-700 transition">
        Go to File Upload
    </a>

</div>

        </aside>

        <main class="w-full md:w-3/4 bg-white rounded-lg shadow-lg p-8 min-h-[500px] flex flex-col items-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-8">Enter Your Sentiment In English Only</h2>
            <div class="w-full max-w-2xl">
                <textarea id="user-input" placeholder="Type your sentiment here..." class="w-full h-32 p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none resize-none text-lg"></textarea>
                <button onclick="analyzeSentiment()" class="w-full mt-4 bg-[#2563eb] text-white text-xl font-bold py-3 rounded-lg hover:bg-blue-700 shadow-lg transition">Analyze</button>
            </div>
            <div id="result-section" class="hidden w-full max-w-2xl mt-12 border-t pt-8 text-center">
                </div>
        </main>
    </div>

    <div x-show="logoutModal" 
         class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
         x-cloak>
        <div class="bg-white rounded-lg p-8 max-w-sm w-full shadow-2xl transform transition-all">
            <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">Are you sure you want to logout?</h3>
            <div class="flex space-x-4">
                <button @click="logoutModal = false" class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-semibold transition">No</button>
                <a href="/logout" class="flex-1 px-4 py-2 bg-red-600 text-white text-center rounded-md hover:bg-red-700 font-semibold transition">Yes</a>
            </div>
        </div>
    </div>

    <footer class="mt-12 mb-8 flex justify-center items-center space-x-6 text-gray-500 text-sm">
        <a href="#">Contact</a><span>|</span><a href="#">Privacy Policy</a><span>|</span>
        <div class="flex items-center space-x-4">
            <span>Follow Us ></span>
            <i class="fab fa-twitter hover:text-blue-400"></i><i class="fab fa-facebook hover:text-blue-600"></i><i class="fab fa-linkedin hover:text-blue-700"></i>
        </div>
    </footer>

    <script>
       async function analyzeSentiment() {

    const input = document.getElementById('user-input').value;

    if (!input.trim()) {
    alert("Please enter text");
    return;
}
   const resSection = document.getElementById('result-section');

    resSection.classList.remove('hidden');
    resSection.innerHTML = `
<div class="text-center text-blue-600 font-bold flex items-center justify-center gap-2">
    <i class="fas fa-spinner fa-spin"></i>
    Analyzing sentiment...
</div>`;

    //Force spinner visible for at least 1.2 seconds
     await new Promise(resolve => setTimeout(resolve, 1200));
     const response = await fetch("/predict", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            text: input
        })
    });

    const result = await response.json();

    // Handle error
    if (result.error) {
        resSection.innerHTML = `
        <div class="bg-red-500 text-white p-4 rounded-lg">
            Error: ${result.error}
        </div>`;
        return;
    }

    let bgColor, iconColor;

    if (result.color === "green") {
        bgColor = "bg-green-500";
        iconColor = "text-green-500";
    }
    else if (result.color === "red") {
        bgColor = "bg-red-500";
        iconColor = "text-red-500";
    }
    else {
        bgColor = "bg-yellow-500";
        iconColor = "text-yellow-500";
    }

    resSection.innerHTML = `
    <div class="${bgColor} p-6 rounded-xl text-white text-left flex items-center space-x-6">

        <div class="bg-white rounded-full p-2">
            <i class="fas ${result.icon} ${iconColor} text-5xl"></i>
        </div>

        <div>
            <p class="text-2xl font-bold">
                Sentiment: ${result.sentiment}
            </p>

            <p class="opacity-90 font-bold">
                Confidence: ${result.confidence}%
                Polarity: ${result.polarity}
            </p>
        </div>

    </div>`;
}

    </script>
</body>
</html>